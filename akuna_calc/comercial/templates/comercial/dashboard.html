{% extends 'core/base.html' %}
{% load static %}
{% load custom_filters %}

{% block title %}Dashboard Comercial{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="bg-white rounded-2xl shadow-lg p-8 lg:p-12 mb-6 border-l-4 border-blue-500">
    <h1 class="text-3xl lg:text-4xl font-bold text-gray-900 mb-3">Administración Comercial</h1>
    <p class="text-lg text-gray-600">Gestión integral de ventas, gastos y reportes</p>
</div>

<!-- Estadísticas -->
<div class="grid grid-cols-1 gap-6 mb-6">
    <!-- Stats removed -->
</div>

<!-- Gráficos -->
<div class="grid grid-cols-1 gap-6 mb-8 animate-fade-in">
    <!-- Charts removed -->
</div>

<!-- Main Actions -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-8 animate-fade-in">
    <div class="group card-elegant bg-white rounded-3xl p-8 shadow-xl">
        <div class="flex items-center mb-8">
            <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-3xl flex items-center justify-center shadow-xl group-hover:shadow-2xl transition-all duration-300">
                <i class="fas fa-chart-line text-white text-2xl"></i>
            </div>
            <div class="ml-6">
                <h3 class="text-2xl font-bold text-slate-800 tracking-tight">Ventas</h3>
                <p class="text-sm text-slate-500 font-medium">Gestión completa</p>
            </div>
        </div>
        <div class="space-y-3">
            <a href="{% url 'comercial:ventas_list' %}" class="btn-primary inline-flex items-center justify-center w-full text-white px-6 py-3 rounded-2xl font-semibold shadow-lg">
                <i class="fas fa-list mr-2"></i>Ver Ventas
            </a>
            <a href="{% url 'comercial:venta_create' %}" class="inline-flex items-center justify-center w-full bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-2xl font-semibold shadow-lg transition-all">
                <i class="fas fa-plus mr-2"></i>Nueva Venta
            </a>
            <a href="{% url 'comercial:clientes_list' %}" class="inline-flex items-center justify-center w-full bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-2xl font-semibold shadow-lg transition-all">
                <i class="fas fa-users mr-2"></i>Clientes
            </a>
        </div>
    </div>

    <div class="group card-elegant bg-white rounded-3xl p-8 shadow-xl">
        <div class="flex items-center mb-8">
            <div class="w-16 h-16 bg-gradient-to-br from-orange-500 to-orange-600 rounded-3xl flex items-center justify-center shadow-xl group-hover:shadow-2xl transition-all duration-300">
                <i class="fas fa-shopping-cart text-white text-2xl"></i>
            </div>
            <div class="ml-6">
                <h3 class="text-2xl font-bold text-slate-800 tracking-tight">Gastos</h3>
                <p class="text-sm text-slate-500 font-medium">Control de egresos</p>
            </div>
        </div>
        <div class="space-y-3">
            <a href="{% url 'comercial:compras_list' %}" class="btn-primary inline-flex items-center justify-center w-full text-white px-6 py-3 rounded-2xl font-semibold shadow-lg">
                <i class="fas fa-list mr-2"></i>Ver Gastos
            </a>
            <a href="{% url 'comercial:compra_create' %}" class="inline-flex items-center justify-center w-full bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-2xl font-semibold shadow-lg transition-all">
                <i class="fas fa-plus mr-2"></i>Nuevo Gasto
            </a>
            <a href="{% url 'comercial:cuentas_list' %}" class="inline-flex items-center justify-center w-full bg-amber-500 hover:bg-amber-600 text-white px-6 py-3 rounded-2xl font-semibold shadow-lg transition-all">
                <i class="fas fa-folder mr-2"></i>Cuentas
            </a>
        </div>
    </div>

    <div class="group card-elegant bg-white rounded-3xl p-8 shadow-xl">
        <div class="flex items-center mb-8">
            <div class="w-16 h-16 bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-3xl flex items-center justify-center shadow-xl group-hover:shadow-2xl transition-all duration-300">
                <i class="fas fa-chart-bar text-white text-2xl"></i>
            </div>
            <div class="ml-6">
                <h3 class="text-2xl font-bold text-slate-800 tracking-tight">Reportes</h3>
                <p class="text-sm text-slate-500 font-medium">Análisis contable</p>
            </div>
        </div>
        <div class="space-y-3">
            <a href="{% url 'comercial:reportes' %}" class="btn-primary inline-flex items-center justify-center w-full text-white px-6 py-3 rounded-2xl font-semibold shadow-lg">
                <i class="fas fa-file-alt mr-2"></i>Reporte Mensual
            </a>
            <a href="{% url 'comercial:reportes' %}" class="inline-flex items-center justify-center w-full bg-teal-500 hover:bg-teal-600 text-white px-6 py-3 rounded-2xl font-semibold shadow-lg transition-all">
                <i class="fas fa-search-dollar mr-2"></i>Por Cuenta
            </a>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Gráfico Evolución Ventas (solo ventas)
    const ctx1 = document.getElementById('evolucionChart');
    if (ctx1) {
        const ventasMeses = JSON.parse('{{ ventas_por_mes|escapejs }}');
        
        if (ventasMeses.length === 0) {
            ctx1.parentElement.innerHTML = '<div class="flex items-center justify-center h-full"><p class="text-slate-400 text-center"><i class="fas fa-chart-line text-4xl mb-2"></i><br>No hay datos para mostrar</p></div>';
        } else {
            const labels = ventasMeses.map(v => {
                const fecha = new Date(v.mes);
                return fecha.toLocaleDateString('es-AR', {month: 'short', year: 'numeric'});
            });
            const data = ventasMeses.map(v => v.total);
            
            new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Ventas',
                        data: data,
                        borderColor: 'rgba(34, 197, 94, 1)',
                        backgroundColor: 'rgba(34, 197, 94, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const parts = context.parsed.y.toFixed(2).split('.');
                                    const integerPart = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, '.');
                                    return 'Ventas: $' + integerPart + ',' + parts[1];
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
                                }
                            }
                        }
                    }
                }
            });
        }
    }
    
    // Gráfico Gastos por Tipo (Dona)
    const ctx2 = document.getElementById('gastosChart');
    if (ctx2) {
        const gastosPorTipo = JSON.parse('{{ compras_por_tipo|escapejs }}');
        
        if (gastosPorTipo.length === 0) {
            ctx2.parentElement.innerHTML = '<div class="flex items-center justify-center h-full"><p class="text-slate-400 text-center"><i class="fas fa-chart-pie text-4xl mb-2"></i><br>No hay datos para mostrar</p></div>';
        } else {
            const labels = gastosPorTipo.map(g => g.tipo);
            const data = gastosPorTipo.map(g => g.total);
            
            new Chart(ctx2, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: [
                            'rgba(59, 130, 246, 0.7)',
                            'rgba(168, 85, 247, 0.7)',
                            'rgba(236, 72, 153, 0.7)',
                            'rgba(251, 146, 60, 0.7)',
                            'rgba(34, 197, 94, 0.7)',
                            'rgba(234, 179, 8, 0.7)'
                        ],
                        borderColor: [
                            'rgba(59, 130, 246, 1)',
                            'rgba(168, 85, 247, 1)',
                            'rgba(236, 72, 153, 1)',
                            'rgba(251, 146, 60, 1)',
                            'rgba(34, 197, 94, 1)',
                            'rgba(234, 179, 8, 1)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                font: { size: 11 },
                                padding: 10
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const parts = context.parsed.toFixed(2).split('.');
                                    const integerPart = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, '.');
                                    return context.label + ': $' + integerPart + ',' + parts[1];
                                }
                            }
                        }
                    }
                }
            });
        }
    }
});
</script>
{% endblock %}